<div class="container payment_cnt" *ngIf="hasCards==true && voucherApplied==false">
  <div class="row">
    <div class="col-6">
      <div class="dropdown">
  <button class="btn  dropdown-toggle border-box" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
    <div class="pl-1">
        <span class="cc-template"><img src="{{cdnUrl}}images/smartbuy/icons/payment/card.png" class="card_img"></span>
    </div>
    <div class=" pl-2 card_details">
      <div class="card-no topcard card_number" *ngIf="selectedCardDetails && selectedCardDetails.card">{{selectedCardDetails.card}} </div>
      <div class="card-name card_type">Credit Card</div>
    </div>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
    <li *ngFor="let card of cards;let i=index;">
      <a class=" border-box" href="javascript:;"  (click)="selectedCard(card.id)">
       <div class="pl-0 ">
                          <span class="cc-template"><img src="{{cdnUrl}}images/smartbuy/icons/payment/card.png" class="card_img"></span>
                      </div>
                      <div class="pl-2 pr-3 card_details">
                        <div class="card-no topcard card_number">{{card.card}}</div>
                        <div class="card-name card_type">Credit Card</div>
                        <!-- <span class="pl-3 d-none"><i class="fa fa-caret-down" aria-hidden="true"></i></span> -->
                      </div>
    </a>
  </li>
    
  </ul>
</div>
     
      
    </div>
    <div class="col-6 pt-2 point-section pay-right">
      <div class="master-text">Reward Points Balance - <span class="pointsavailble">{{points_available}}</span> pts</div>
          <div class="col-12 note">Note: <span class="ptcon">1 point = {{points_percentage}} Rs</span></div>
    </div>
    
      <div class="col-6">Pay with Points and Money</div>
      <div class="col-6"><span id="selectedPoints" class="minpoints" *ngIf="value>0">{{value |number}} pts <span *ngIf="value>0 && (orderamount - value*points_percentage)>0">+</span></span><span class="balamt" *ngIf="(orderamount - value*points_percentage)>0">  &#8377; {{orderamount - value*points_percentage |number}}</span>
      </div>
       <div class="box-m " *ngIf="voucherslider">
          <div class="box-sub showslider">
            <div class="col-md-12 my-4 slider-container">
              <div class="row">
                  <div class="col-md-12">
                    <div class="my-3">
                      <!-- [(value)]="value" -->
                        <ng5-slider [(ngModel)]="value"  [options]="options" (change)="onChangePoint()"></ng5-slider>
                    </div>
                  </div>
              </div>
            </div>
            <form [formGroup]="Formotp" (ngSubmit)="generateVoucherOtp()">
            <div class="col-md-12">
              <p>Please note that you can pay maximum {{redemption_value}}% of the transaction amount through Points i.e,<br>
              &#8377; <span>{{(orderamount* (redemption_value/100)) |number}}</span> ({{redemption_value |number}}% of &#8377;<span>{{orderamount |number}}</span>) only. Balance amount should be paid by Card or Account. </p>
               <div class="form-check pt-10">
                <input class="form-check-input" [(ngModel)]="otpaccepted" type="checkbox" formControlName="termsconditionvoucher" name="termsconditionvoucher" id="termsconditionvoucher">
                <label class="form-check-label xs-check-font" for="termsconditionvoucher" >
                    By Redeeming points you agree to our <a href="{{domainRedirect}}terms_conditions" target="_blank" >Terms & Conditions</a> Terms and Conditions
                </label>
                <div *ngIf="submittedotpform && Formotp.controls.termsconditionvoucher.errors" class="error">
                                <small *ngIf="Formotp.controls.termsconditionvoucher.errors.required || Formotp.controls.termsconditionvoucher.errors.pattern">Please accept Terms and Conditions</small>
                            </div>
            </div>
               
              
              <div class="col-12 text-center">
                <button type="submit" class="btn btn-primary w-50" id="header_submit3">Get OTP</button>
              </div>
            </div>
          </form>
          </div>
        </div>
    
  </div>
  
</div>
<div class="container payment_cnt" *ngIf="voucherOtp">
  <div class="col-12">
<form [formGroup]="Formotpvalidate" (ngSubmit)="OTPVerification()">
        <div class="redeem-verification-section">
            <p class="ver-info pb-4">OTP has been generated successfully and sent to your HDFC Bank registered Email ID/Mobile Number</p>
            <div class="row">
                <div class="col-md-12">
                    <div class="voucher-code-entry">
                        <div class="pad_bottom_10 redeem-title pb-2">
                            <span class="pull-right">
                            </span>
                        </div>
                       <div class="otp_input">
                         <input type="text" autocomplete="nope" placeholder="Enter OTP" maxlength="10" formControlName="otp" (keypress)="numberInput($event)" onCopy="return false" onDrag="return false" onDrop="return false" onPaste="return false" >
                          <a href="javascript:" (click)="resendOTP(cd1)"> Resend OTP</a>
                       </div>

                        <div class="time-left pt-2" *ngIf="otpCounter">
                            <p><span class="voucherotpcountdown">
                                <countdown #cd1 [config]="{ leftTime: 900, format: 'mm:ss'}" (finished)="onFinishedTimer()" (event)="handleEvent($event,cd1)"></countdown>
                            </span> Mintues Left</p>
                        </div>
                        <div *ngIf="submittedFormotpvalidate && Formotpvalidate.controls.otp.errors" class="error">
                                <small *ngIf="Formotpvalidate.controls.otp.errors.required">Please enter OTP.</small>
                                <small *ngIf="Formotpvalidate.controls.otp.errors.pattern">Please enter a valid OTP.</small>
                                
                        </div>
                        <div class="error" *ngIf="otperror">
                          <small *ngIf="otperror">{{otperrormsg}}</small>
                        </div>
                       
                    </div>
                </div>
            </div>
            <div class="gy-3 row text-center">
               <div class="col-xs-6 ml-4">
                    <button type="submit" class="w-50 btn btn-primary redeem-active-btn nxt-redeem-success" data-dismiss="modal">Done</button>
                </div>
                <div class="col-xs-6">
                    <button class="w-50 btn  ml-3 redeem-default-btn" data-dismiss="modal" (click)="closeotp()">Cancel</button>
                </div>
               
            </div>
        </div>
    </form>
  </div>
</div>
<div class="container payment_cnt" *ngIf='voucherDiv'>
  <div class="row">
    <div class="col-6"><img src="{{cdnUrl}}images/smartbuy/icons/payment/voucher.png" alt="Voucher"> Have a Voucher?</div>
    <div class="col-6 text-right" >
      <div (click)="voucherForm()" *ngIf="!voucherapplyform" class="voucher_apply">Apply Voucher</div>
    </div>
  </div>
  <div class="col-12" *ngIf="voucherapplyform">
      <p>Please enter the below details to redeem Points</p>
      <form  [formGroup]="voucherForm1" (ngSubmit)="applyVoucher()">
        <div class="my-3">
            <!-- <h6 class="w-80">{{data.popup}} Please Enter Your Credit Card Details</h6> -->
                <!-- <div> -->
                    <div class="voucher-code-entry card-num-edit">
                        
                        <div class="row">
                        <div class="col-sm-4 col-12 ">
                            <div class="row two-inputs m-0 ">
                                <div class="col-sm-6  col-6 p-0">
                                    <input class="cus-input" type="text" formControlName="first4digit" placeholder="123456789" autocomplete="nope" (keypress)="numberInput($event);AvoidSpace($event)" name="first4digit" maxlength="9" autofocus="on">
                                </div>
                                <div class="col-sm-3 col-3 pl-0 py-2">
                                    <span class="crad_x">XXX</span>
                                </div>
                                <div class="col-sm-3 col-3 p-0">
                                    <input class="cus-input" type="text" formControlName="last4digit" placeholder="1234" autocomplete="nope" (keypress)="numberInput($event);AvoidSpace($event)" name="first4digit" maxlength="4">
                                </div>
                            </div>
                            <div class="small-gray-text">First 9 digits and last 4 digits</div>
                              <div *ngIf="(submitted1 && voucherForm1.controls.first4digit.errors) || (submitted1 && voucherForm1.controls.last4digit.errors)" class="error">
                            <small *ngIf="voucherForm1.hasError('required','first4digit') || voucherForm1.hasError('required','last4digit')">Please enter first 9 Digits and last 4 digits is required.</small>
                            <small *ngIf="voucherForm1.hasError('pattern','first4digit') || voucherForm1.hasError('pattern','last4digit')">Please enter valid card number.</small>   
                        </div>
                        <div *ngIf="submitted1 && voucherForm1.get('first4digit').dirty" class="error">
                            <small *ngIf="voucherForm1.hasError('isCardValid','first4digit')">Invalid Card. The card details entered is not enabled for Rewards program. Please contact the Bank for more details.</small>
                        </div>
                        </div>
                      
                    <!-- </div> -->
                    <div class="voucher-code-entry col-sm-4 col-12">
                        <!-- <div class="small-gray-text"> <small style="color: #aaa;font-size: 10px;">Registered with HDFC bank</small></div> -->
                        <input type="text" formControlName="applymobile" [(ngModel)]="customermobile" [value]="customermobile" autocomplete="nope" name="applymobile"  maxlength="10" (keypress)="numberInput($event);AvoidSpace($event)" onCopy="return false" onDrag="return false" onDrop="return false" onPaste="return false" placeholder="Mobile Number">

                        <div *ngIf="submitted1 && voucherForm1.controls['applymobile']['errors']" class="error">
                                <small *ngIf="voucherForm1.hasError('required','applymobile')">Please enter the registered mobile number.</small>
                                <small *ngIf="voucherForm1.hasError('pattern','applymobile')">Please enter a valid 10 digits mobile number.</small>
                        </div>
                        <div class="small-gray-text">Registered with HDFC bank</div>
                    </div>
                    <div class="voucher-code-entry date-section col-sm-4 col-12">
                            <!-- <input id="applydate1"  type="text" autocomplete="off" placeholder="dd/mm/yyyy" > -->
                            <input matInput [matDatepicker]="picker1" [max]="checkDate" placeholder="Date of Birth" readonly="true" formControlName="dob"> 
                            <mat-datepicker-toggle matSuffix [for]="picker1" class="date-icon"></mat-datepicker-toggle>
                            <mat-datepicker #picker1></mat-datepicker>
                            <div *ngIf="submitted1 && voucherForm1.controls['dob']['errors']" class="error">
                                <small *ngIf="voucherForm1.hasError('required','dob')">Please enter date of birth.</small>
                            </div>
                    </div>

                    <div class="voucher-code-entry col-sm-4 col-12 mt-15">
                        <!-- <div class="small-gray-text">Voucher Code</div> -->
                        <input id="applyvouchercode" formControlName="applyvouchercode" type="text" autocomplete="nope" placeholder="Voucher Code"  maxlength="30" (keypress)="specialcharInput($event);AvoidSpace($event)" (keyup)="convertToUpperCase($event)">
                        <div *ngIf="submitted1 && voucherForm1.controls['applyvouchercode']['errors']" class="error">
                                <small *ngIf="voucherForm1.hasError('required','applyvouchercode')">Please enter voucher code.</small>
                                <small *ngIf="voucherForm1.hasError('pattern','applyvouchercode')">Please enter a valid voucher code.</small>
                        </div>
                    </div>
                  </div>
                    
                </div>   
                <div class="text-right">     
                
                <button type="button" class="btn  my-3 voucher_apply" (click)="applyVoucherCancel()">Cancel</button>
                <button type="submit" class="btn btn-primary my-3 " (click)="applyVoucher()"><a href="javascript:;">Apply</a></button>
                </div>
        </div>
    </form>
  </div>
</div>
<div class="container payment_cnt" *ngIf="addcardDiv">
  <div class="row">
    <div class="col-6"><img src="{{cdnUrl}}images/smartbuy/icons/payment/new_card.png" alt="Voucher"> Would you like use another card</div>
    <div class="col-6 text-right">
      <div (click)="addCardform()" *ngIf="!voucheraddform" class="voucher_apply">Add Card</div>
    </div>
  </div>
  <div class="col-12" *ngIf="voucheraddform">
     
      <form  [formGroup]="cardaddForm1" (ngSubmit)="addcardform()">
        <div class="my-3">
            <!-- <h6 class="w-80">{{data.popup}} Please Enter Your Credit Card Details</h6> -->
                <!-- <div> -->
                    <div class="voucher-code-entry card-num-edit">
                        
                        <div class="row">
                        <div class="col-sm-4 col-12 ">
                            <div class="row two-inputs m-0">
                                <div class="col-sm-6  col-6 p-0">
                                    <input class="cus-input" type="text" formControlName="first4digit" placeholder="123456789" autocomplete="nope" (keypress)="numberInput($event);AvoidSpace($event)" name="first4digit" maxlength="9" autofocus="on">
                                </div>
                                <div class="col-sm-3 col-3 pl-0 py-2">
                                    <span class="crad_x">XXX</span>
                                </div>
                                <div class="col-sm-3 col-3 p-0">
                                    <input class="cus-input" type="text" formControlName="last4digit" placeholder="1234" autocomplete="nope" (keypress)="numberInput($event);AvoidSpace($event)" name="first4digit" maxlength="4">
                                </div>
                            </div>
                            <div class="small-gray-text">First 9 digits and last 4 digits</div>
                              <div *ngIf="(submitted2 && cardaddForm1.controls.first4digit.errors) || (submitted2 && cardaddForm1.controls.last4digit.errors)" class="error">
                            <small *ngIf="cardaddForm1.hasError('required','first4digit') || cardaddForm1.hasError('required','last4digit')">Please enter first 9 Digits and last 4 digits is required.</small>
                            <small *ngIf="cardaddForm1.hasError('pattern','first4digit') || cardaddForm1.hasError('pattern','last4digit')">Please enter valid card number.</small>   
                        </div>
                        <div *ngIf="submitted2 && cardaddForm1.get('first4digit').dirty" class="error">
                            <small *ngIf="cardaddForm1.hasError('isCardValid','first4digit')">Invalid Card. The card details entered is not enabled for Rewards program. Please contact the Bank for more details.</small>
                        </div>
                        </div>
                      
                    <!-- </div> -->
                    <div class="voucher-code-entry col-sm-4 col-12">
                        <!-- <div class="small-gray-text"> <small style="color: #aaa;font-size: 10px;">Registered with HDFC bank</small></div> -->
                        <input type="text" formControlName="applymobile" [(ngModel)]="customermobile" [value]="" autocomplete="nope" name="applymobile"  maxlength="10" (keypress)="numberInput($event);AvoidSpace($event)" onCopy="return false" onDrag="return false" onDrop="return false" onPaste="return false" placeholder="Mobile Number">

                        <div *ngIf="submitted2 && cardaddForm1.controls['applymobile']['errors']" class="error">
                                <small *ngIf="cardaddForm1.hasError('required','applymobile')">Please enter the registered mobile number.</small>
                                <small *ngIf="cardaddForm1.hasError('pattern','applymobile')">Please enter a valid 10 digits mobile number.</small>
                        </div>
                        <div class="small-gray-text">Registered with HDFC bank</div>
                    </div>
                    <div class="voucher-code-entry date-section col-sm-4 col-12">
                            <!-- <input id="applydate1"  type="text" autocomplete="off" placeholder="dd/mm/yyyy" > -->
                            <input matInput [matDatepicker]="picker1" [max]="checkDate" placeholder="Date of Birth" readonly="true" formControlName="dob"> 
                            <mat-datepicker-toggle matSuffix [for]="picker1" class="date-icon"></mat-datepicker-toggle>
                            <mat-datepicker #picker1></mat-datepicker>
                            <div *ngIf="submitted2 && cardaddForm1.controls['dob']['errors']" class="error">
                                <small *ngIf="cardaddForm1.hasError('required','dob')">Please enter date of birth.</small>
                            </div>
                    </div>
                  </div>
                  
                </div>   
                <div class="text-right">     
                
                <button type="button" class="btn  my-3 voucher_apply" (click)="addCardCancel()">Cancel</button>
                <button type="submit" class="btn btn-primary my-3 w-25" (click)="addcardform()"><a href="javascript:;">Add</a></button>
                </div>
        </div>
    </form>
  </div>
</div>
<div class="container payment_cnt" *ngIf="voucherApplied">
  <div class="row">
    <div class="col-6">
      <div class="row">
        <div class="col-2">
          <img class="voucherImg" src="{{cdnUrl}}images/smartbuy/icons/payment/voucher_success.png">
        </div>
        <div class="col-10">
          <p class="green-font"><strong>Congratulations! </strong></p>
          <p class="green-font">Points has been redeemed successfully!</p>
          <div class="brown-box">
            <p>Pay remaining amount by cash</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-6 grey-box">
      <div class="row">
      <div class="col-6">
        <div *ngIf="voucherCodedetails">
          <p class="vouchertitle">Voucher Code</p>
          <p>1606202212334475</p>
        </div>
      
    </div>
    <div class="col-6">
      <p class="vouchertitle">Redeemed Points</p>
      <p>{{RedeemedPoints}} Points</p>
    </div>
    </div>
    </div>
    
  </div>
  
</div>
